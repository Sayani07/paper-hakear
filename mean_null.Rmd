---
title: "Simulations, CLT and EVT"
author: "Sayani Gupta"
date: "25/08/2020"
output: pdf_document
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE, comment = "#>",
  fig.path = "figure/", fig.align = "center", fig.show = "hold",
  cache = TRUE, cache.path = "cache/",
  out.width = ifelse(is_html_output(), "100%", "\\textwidth")
)
knitr::opts_knit$set(root.dir = here::here())
read_chunk('mean_null.R')
```

Discussion: Let the sample size be $n$ and the number of iterations be $k$. By CLT (or EVT), when $n$ is high enough, then the limiting distribution of sample mean (or max) goes to a standard normal (or Gumbel/Freschet/Weibull) distribution, irrespective of the underlying distribution of the sample. This means when $n$ is high enough and we sample $n$ iid random variables multiple times (high enough $k$), by CLT, the distribution of sample mean would look like standard normal. What if $n$ is very small and $k$ is large? Would the distribution of sample mean still look like standard normal? It would not. Similarly, EVT works when $n$ is high enough. When we are taking the max of 2 or 3 rvs ("levels" in our terminology), $n = 2/3$, which are far too less. Hence, normalization would be able to nullify the effect of $n$ only for large enough $n$.

Simulation Study:

Samples are taken from Gamma(shape = 3, rate = 0.5) distribution and $k = 500$ in all the cases. Small values of n considered in the range  ${2, 3, \ldots, 10}$ and large values of $n$ considered within ${25, 30, 35, \ldots, 45}$. We study the distribution of:

 1. sample means for small $n$ 
(Obs: distribution doesn't look similar or normal)

 2. sample means for large $n$
(Obs: distribution looks similar and normal like with different scales)

 3. normalized sample means for small $n$
(Obs: distribution doesn't look similar)
 
 4. normalized sample means for large $n$ 
(Obs: distribution looks similar in both shape and scale with mean 0)
 
 5. sample maximums for small $n$ 
(Obs: distribution doesn't look too different except for tails, high scale)

 6. sample maximums for large $n$ 
(Obs: distribution looks similar and positively skewed with very high scales)
 
 7. normalized sample maximums for small $n$ 
(Obs: distribution doesn't look similar, scaled down, maybe similar after facet label 5)

 8. normalized sample maximums for large $n$ 
(Obs: distribution looks similar and it has been scaled down much more than maximum without normalization. Can we use this fact to explore maximums more?)

Question: So we cannot normalize for the number of levels using limit theorems when we are talking about normalizing for few levels? By normalization, if we mean adjusting values measured on different scales to a common scale, then that could be done through limit theorems. If the intention is to align distributions to a normal like distribution, then we have to resort to something else like distribution transformation?

# CLT

Suppose that $X_1$, $X_2$ , ... , $X_n$ are i.i.d. random variables with expected values $E(X_i) = \mu < \infty$ and variance $Var(X_i) = \sigma^2 < \infty$.
Suppose the sample mean is $\bar{X} = \frac{(X_1 + X_2 + \ldots + X_n)}{n}$, then by CLT the distribution of the normalized random variable:
$Z_n = \frac{\bar{X} - \mu}{\sqrt n\sigma}$ converges in distribution to a standard normal distribution.


```{r shape_rate}
```

```{r create_simdata}

```


```{r create_nlevels}
```

```{r norm_mean}
```

```{r norm_max}

```

```{r create_scenarios}

```

# Small levels and many iterations of means

```{r mean_small}

```

In facet  with label 2, two random numbers are generated and their mean is computed. We repeat this process 500 times and draw the histogram of the computed means. Similarly, for facet with label 3, 3 random numbers are generated and histogram is drawn for the computed means of 3 random numbers.


# Many levels and many iterations of means

```{r mean_large}

```

The histograms look like a normal distribution in this case, because number of levels are higher. For smaller number of levels, even with many repetitions the histograms do not look like normal.

# Small levels and many iterations of normalized means

```{r norm_mean_small}

```

# Many levels and many iterations of normalized means


```{r norm_mean_large}

```

# EVT

## Small levels and many iterations of max


```{r max_small}
```

## Many levels and many iterations of max

```{r max_large}
```



## Small levels and many iterations of norm max

```{r norm_max_small}
```

## Many levels and many iterations of norm max


```{r norm_max_large}
```
